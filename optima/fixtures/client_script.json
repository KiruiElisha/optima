[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2024-11-14 07:21:47.269807",
  "module": "Optima",
  "name": "Optima Sales Order",
  "script": "frappe.ui.form.on('Sales Order', {\n    refresh: function(frm) {\n        // Ensure actions are only available for submitted documents\n        if (frm.doc.docstatus === 1) {\n            // Add retry button for failed syncs\n            if (frm.doc.custom_optima_sync_status === \"Failed\") {\n                frm.add_custom_button(__('Retry Optima Sync'), function() {\n                    frappe.confirm(\n                        __('Are you sure you want to retry syncing this order to Optima?'),\n                        function() {\n                            // Clear previous error\n                            frm.set_value('custom_optima_sync_error', '');\n                            frm.set_value('custom_optima_sync_status', 'Pending');\n                            \n                            frappe.call({\n                                method: 'optima.optima.utils.order_sync.enqueue_optima_order_sync',\n                                args: {\n                                    sales_order: frm.doc.name\n                                },\n                                freeze: true,\n                                freeze_message: __('Queuing sync...'),\n                                callback: function(r) {\n                                    frm.reload_doc();\n                                }\n                            });\n                        }\n                    );\n                }, __('Actions'));\n            }\n            \n            // Show sync error if any\n            if (frm.doc.custom_optima_sync_error) {\n                frm.dashboard.add_comment(__('Optima Sync Error: {0}', [frm.doc.custom_optima_sync_error]), 'red');\n            }\n            \n            // Show sync status\n            if (frm.doc.custom_optima_sync_status) {\n                let indicator = {\n                    'Pending': 'orange',\n                    'Synced': 'green',\n                    'Failed': 'red'\n                }[frm.doc.custom_optima_sync_status] || 'gray';\n                \n                frm.dashboard.add_comment(\n                    __('Optima Sync Status: {0}', [frm.doc.custom_optima_sync_status]),\n                    indicator\n                );\n            }\n        }\n    },\n    \n    custom_send_to_optima: function(frm) {\n        // Clear sync status when toggling send to optima\n        if (!frm.doc.custom_send_to_optima) {\n            frm.set_value('custom_optima_sync_status', 'Not Synced');\n            frm.set_value('custom_optima_sync_error', '');\n        }\n    }\n});",
  "view": "Form"
 }
]